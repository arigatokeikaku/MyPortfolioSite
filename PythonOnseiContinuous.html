<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

    <title>Document</title>
</head>

<body>

    <py-config>
        packages = []
        sys.path.append("https://japaneast.api.cognitive.microsoft.com/sts/v1.0/issuetoken")  <!-- Azure Cognitive ServicesのPython SDKのパス -->
    </py-config>

    <py-script>
        import azure.cognitiveservices.speech as speechsdk
        import time

        speech_config = speechsdk.SpeechConfig(subscription="YourSpeechKey", region="YourSpeechRegion")
        speech_config.speech_recognition_language = "ja-JP"

        # 以下略（以前のコードの続き）


        def from_mic():
            speech_recognizer = speechsdk.SpeechRecognizer(speech_config=speech_config)

            print("Speak into your microphone.")
            result = speech_recognizer.recognize_once_async().get()
            print(result.text)

        from_mic()

        audio_config = speechsdk.audio.AudioConfig(filename=weatherfilename)
        speech_recognizer = speechsdk.SpeechRecognizer(speech_config=speech_config, audio_config=audio_config)

        done = False

        def stop_cb(evt):
            print('CLOSING on {}'.format(evt))
            speech_recognizer.stop_continuous_recognition()
            nonlocal done
            done = True

        speech_recognizer.recognizing.connect(lambda evt: print('RECOGNIZING: {}'.format(evt)))
        speech_recognizer.recognized.connect(lambda evt: print('RECOGNIZED: {}'.format(evt)))
        speech_recognizer.session_started.connect(lambda evt: print('SESSION STARTED: {}'.format(evt)))
        speech_recognizer.session_stopped.connect(lambda evt: print('SESSION STOPPED {}'.format(evt)))
        speech_recognizer.canceled.connect(lambda evt: print('CANCELED {}'.format(evt)))

        speech_recognizer.session_stopped.connect(stop_cb)
        speech_recognizer.canceled.connect(stop_cb)

        speech_recognizer.start_continuous_recognition()
        while not done:
            time.sleep(.5)
    </py-script>

</body>

</html>
