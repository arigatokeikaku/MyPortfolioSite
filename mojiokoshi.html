<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音声テキスト化システム</title>
</head>
<body>
    <h1>音声テキスト化システム</h1>
    <button id="startRecognition">音声認識を開始</button>
    <p>テキスト化した結果: </p>
    <div id="textResult"></div>

    <script>
        // SpeechRecognitionオブジェクトを生成
        SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
        const recognition = new SpeechRecognition();

        recognition.continuous = true; // 連続的な音声認識
        recognition.lang = 'ja-JP'; // 言語設定

        let lastResultIndex = 0; // 最後に処理したresultのインデックス

        // 音声認識イベントのハンドラ
        recognition.addEventListener('result', (event) => {
            let newText = "";

            // 最後に処理したインデックスから新しい結果のみを処理
            for (let i = lastResultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    newText += event.results[i][0].transcript;
                }
            }

            // 処理した結果のインデックスを更新
            lastResultIndex = event.results.length;

            // テキストを画面に表示
            document.getElementById('textResult').textContent += newText;
        });

        // 音声認識開始
        document.getElementById('startRecognition').addEventListener('click', function() {
            lastResultIndex = 0; // インデックスをリセット
            recognition.start();
        });

        // 音声認識が終了したら再開
        recognition.addEventListener('end', () => {
            recognition.start();
        });

        // 音声認識エラーのハンドリング
        recognition.addEventListener('error', (event) => {
            console.error('音声認識エラー:', event.error);
            recognition.start(); // エラー発生時に再開
        });
    </script>
</body>
</html>
