<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音声テキスト化システム</title>
</head>
<body>
    <h1>音声テキスト化システム</h1>
    <button id="startRecognition">音声認識を開始</button>
    <p>テキスト化した結果: </p>
    <div id="textResult"></div>

    <script>
        SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
        const recognition = new SpeechRecognition();

        recognition.continuous = true; // 連続的な音声認識
        recognition.lang = 'ja-JP'; // 言語設定
        recognition.interimResults = true; // 中間結果を取得

        let accumulatedText = "";

        // 音声認識イベントのハンドラ
        recognition.addEventListener('result', (event) => {
            let currentText = "";

            // 最新の結果を処理
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                currentText += event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    accumulatedText += currentText;
                    currentText = ""; // 最終結果の後に中間結果をクリア
                }
            }

            // 画面にテキスト表示
            document.getElementById('textResult').textContent = accumulatedText + currentText;
        });

        // 音声認識開始
        document.getElementById('startRecognition').addEventListener('click', function() {
            recognition.start();
        });

        // 音声認識が終了したら再開
        recognition.addEventListener('end', () => {
            recognition.start();
        });

        // 音声認識エラーのハンドリング
        recognition.addEventListener('error', (event) => {
            console.error('音声認識エラー:', event.error);
            recognition.start(); // エラー発生時に再開
        });
    </script>
</body>
</html>
